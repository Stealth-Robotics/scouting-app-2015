Please do change where/how the error message is done. I didn't look at the code very much, so I just put it where the crash happened.